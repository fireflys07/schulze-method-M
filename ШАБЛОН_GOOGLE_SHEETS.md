# Готовый шаблон Google Sheets для оценки докладов

**Редактор:** Мозжухин Марк

---

## Быстрый старт

### Шаг 1: Создайте новую таблицу в Google Sheets

Скопируйте следующую структуру:

```
| A                | B          | C       | D       | E       | F       | G       | H                | I                  |
|------------------|------------|---------|---------|---------|---------|---------|------------------|--------------------|
| Имя оценщика     | Тип        | Группа1 | Группа2 | Группа3 | Группа4 | Группа5 | Формула          | Результат          |
| Судья 1          | Судья      | 1       | 2       | 3       | 4       | 5       | =PREFERENCES(1;"A";C2:G2;99) | (автоматически)    |
| Судья 2          | Судья      | 2       | 1       | 3       | 4       | 5       | =PREFERENCES(1;"A";C3:G3;99) |                    |
| Студент 1        | Аудитория  | 1       | 3       | 2       | 4       | 5       | =PREFERENCES(1;"A";C4:G4;99) |                    |
| Студент 2        | Аудитория  | 2       | 1       | 4       | 3       | 5       | =PREFERENCES(1;"A";C5:G5;99) |                    |
| Студент 3        | Аудитория  | 1       | 2       | 3       | 5       | 4       | =PREFERENCES(1;"A";C6:G6;99) |                    |
```

### Шаг 2: Установите функцию PREFERENCES

1. Откройте **Расширения → Apps Script** в Google Sheets
2. Удалите весь существующий код
3. Вставьте следующий код:

```javascript
/**
 * Preference input data builder is a part of the project: https://github.com/pponec/schulze-method
 * Usage in the cell: =PREFERENCES(B3;"A";C3:G3; 99)
 * @param {number} count Number of voters per ballot.
 * @param {string} firstColName A character of the first elected candidate.
 * @param {array} array Array of preferences.
 * @param {number} defValue Default priority in case the value is missing.
 * @return Text format with a description of preferences, the group separator is a dash.
 * @customfunction
*/
function PREFERENCES(count, firstColName, array, defValue) {
    // Check input values:
    if (!array || array.length !== 1 || array[0].length < 2) {
        return 'ERROR';
    }
    if (count === null || count === '' || count === undefined) {
        return '';
    }
    if (!Number.isInteger(count)) {
        count = 1;
    }
    if (typeof firstColName !== 'string' || !firstColName.length) {
         firstColName = 'A';
    }
    const row = array[0];

    // Replace invalid cell values:
    const values = row.map(value => {
        return Number.isInteger(value) ? value : defValue;
    });

    // Sort unique values
    const uniqueSortedValues = [...new Set(values)].sort((a, b) => a - b);
    const groups = uniqueSortedValues.map(() => []);

    // Split index to columns by values
    values.forEach((value, index) => {
        groups[uniqueSortedValues.indexOf(value)].push(
            String.fromCharCode(firstColName.charCodeAt(0) + index));
    });

    // Build the result
    const result = count + ':' + groups.map(group => group.join('')).join('-');
    return result;
}
```

4. Сохраните (Ctrl+S или Cmd+S)
5. Закройте редактор скриптов

### Шаг 3: Используйте формулу

1. В ячейке H2 вставьте: `=PREFERENCES(1;"A";C2:G2;99)`
2. Скопируйте формулу вниз для всех строк с оценщиками
3. Колонка I автоматически заполнится результатами

### Шаг 4: Скопируйте результаты

1. Выделите все ячейки из колонки I (кроме заголовка)
2. Скопируйте (Ctrl+C)
3. Вставьте в калькулятор Шульце
4. Получите итоговый порядок!

---

## Как заполнять приоритеты

### Вариант 1: Простая ранжировка

Каждая группа получает уникальный приоритет (1, 2, 3, 4, 5):

| Группа1 | Группа2 | Группа3 | Группа4 | Группа5 | Результат      |
|---------|---------|---------|---------|---------|----------------|
| 1       | 2       | 3       | 4       | 5       | `1:A-B-C-D-E`  |
| 2       | 1       | 3       | 4       | 5       | `1:B-A-C-D-E`  |

**1 = лучшая группа, 2 = вторая, и т.д.**

### Вариант 2: С равными предпочтениями

Если две группы одинаково хороши, дайте им одинаковый приоритет:

| Группа1 | Группа2 | Группа3 | Группа4 | Группа5 | Результат       |
|---------|---------|---------|---------|---------|-----------------|
| 1       | 2       | 3       | 3       | 4       | `1:A-B-CD-E`    |
| 2       | 1       | 3       | 3       | 4       | `1:B-A-CD-E`    |

**CD означает, что Группа3 и Группа4 равны.**

### Вариант 3: Вес голосов

Если у судьи больше веса, измените первый параметр:

- Судья: `=PREFERENCES(2;"A";C2:G2;99)` (вес = 2)
- Студент: `=PREFERENCES(1;"A";C3:G3;99)` (вес = 1)

---

## Расширенный шаблон с подсчетом баллов

### Добавьте дополнительные колонки:

| ... | Результат | Итоговый порядок | Баллы |
|-----|-----------|------------------|-------|
| ... | `1:A-B-C-D-E` | (из калькулятора) | 6 |

**Формула для конвертации позиции в баллы:**

```
=IF(I2="A";6;IF(I2="B";5;IF(I2="C";4;IF(I2="D";3;IF(I2="E";2;0)))))
```

Или используйте функцию RANK для автоматического расчета.

---

## Примеры использования

### Пример 1: 5 групп, 3 оценщика

**Данные в Sheets:**
```
Иванов | Судья   | 1 | 2 | 3 | 4 | 5
Петров | Судья   | 2 | 1 | 3 | 4 | 5  
Сидоров| Студент | 1 | 3 | 2 | 4 | 5
```

**Результаты:**
```
1:A-B-C-D-E
1:B-A-C-D-E
1:A-C-B-D-E
```

**Вставьте в калькулятор Шульце - получите итоговый порядок!**

### Пример 2: С равными предпочтениями

**Данные:**
```
Судья | 1 | 2 | 3 | 3 | 4
```

**Результат:** `1:A-B-CD-E` (Группа3 и Группа4 равны)

---

## Советы по работе

1. **Защита данных:** Заблокируйте формулы (Право доступа → Только просмотр для формул)
2. **Валидация данных:** Используйте проверку данных для столбцов с приоритетами (1-5 или допустимый диапазон)
3. **Цветовое кодирование:** Раскрасьте строки судей и аудитории разными цветами
4. **Резервная копия:** Регулярно делайте копию таблицы
5. **Обучение:** Перед началом проведите тестовое голосование

---

## Часто задаваемые вопросы

**Q: Что делать, если групп больше 5?**
A: Просто добавьте больше колонок (Группа6, Группа7...) и обновите диапазон в формуле: `C2:H2` для 6 групп.

**Q: Как обозначить больше групп?**
A: Система автоматически использует буквы A-Z. Для групп больше 26 нужно изменить логику, но обычно хватает.

**Q: Можно ли использовать веса для разных типов оценщиков?**
A: Да! Измените первый параметр в PREFERENCES: судья = 2, студент = 1.

**Q: Что если оценщик не присутствовал на выступлении какой-то группы?**
A: Дайте этой группе максимальный приоритет (например, 99) - она будет считаться самой низкой.

---

## Автоматизация (опционально)

Можно создать второй лист, который автоматически собирает все результаты:

1. Создайте лист "Результаты"
2. Используйте формулу для сбора всех значений из колонки I:
   ```
   =ФИЛЬТР(Лист1!I2:I1000; Лист1!I2:I1000<>"")
   ```
3. Скопируйте результат одной командой!

---

**Редактор:** Мозжухин Марк

